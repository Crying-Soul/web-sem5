server {
	listen 443 ssl http2;
	server_name tetris.local;

	root /home/lotos/web/lb1/dist;
	index index.html;

	include /etc/nginx/mime.types;
	default_type application/octet-stream;

	ssl_certificate /home/lotos/web/lb1/certs/server.crt;
	ssl_certificate_key /home/lotos/web/lb1/certs/server.key;

	add_header X-Frame-Options "SAMEORIGIN" always;
	add_header X-XSS-Protection "1; mode=block" always;
	add_header X-Content-Type-Options "nosniff" always;

	# JavaScript модули
	location ~* \.(js|mjs)$ {
		try_files $uri =404;
		access_log off;
		expires max;
		add_header Cache-Control "public, max-age=31536000, immutable";
		add_header Content-Type application/javascript;
		default_type application/javascript;
	}

	# CSS файлы
	location ~* \.css$ {
		try_files $uri =404;
		access_log off;
		expires max;
		add_header Cache-Control "public, max-age=31536000, immutable";
		add_header Content-Type text/css;
		default_type text/css;
	}

	# Остальные статические файлы
	location ~* \.(?:json|png|jpg|jpeg|gif|ico|svg|webp|woff2?|ttf|eot)$ {
		try_files $uri =404;
		access_log off;
		expires max;
		add_header Cache-Control "public, max-age=31536000, immutable";
	}

	# index.html
	location = /index.html {
		try_files $uri =404;
		add_header Cache-Control "no-cache, no-store, must-revalidate";
		add_header Content-Type text/html;
	}

	# SPA fallback
	location / {
		try_files $uri $uri/ $uri.js /index.html;
	}

	# скрытые файлы
	location ~ /\. {
		deny all;
		access_log off;
		log_not_found off;
	}

	client_max_body_size 10M;
}

server {
	listen 80;
	server_name tetris.local;
	return 301 https://$host$request_uri;
}